---
language:
  - c++
sudo: false
matrix:
  fast_finish: true
  include:
    - compiler: gcc
      env: XCC=gcc XCXX=g++
    - compiler: clang
      env: XCC=clang XCXX=clang++
    - env: XCC="gcc -m32" XCXX="g++ -m32"
      addons:
        apt:
          packages:
            - g++-multilib
            - gcc-multilib
    - name: aarch64
      addons:
        apt:
          packages:
            - aarch64-linux-gnu-gcc
            - aarch64-linux-gnu-g++
      env: XCC="aarch64-linux-gnu-gcc" XCXX="aarch64-linux-gnu-g++"
      services: docker
      install:
        - |
          if [ "$(uname -m)" = x86_64 ]; then
            docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
          fi
        - |
          travis_retry docker build --rm -t smhasher \
            --build-arg BASE_IMAGE=arm64v8/fedora \
            -f Dockerfile .
      script:
        - |
          docker run --rm -t smhasher \
            sh -c "cmake . -DCMAKE_TOOLCHAIN_FILE=CMakeARM64Cross.txt && cmake --build . test"

script:
  - CC="$XCC" CXX="$XCXX" cmake .
  - make -j4 VERBOSE=1
  - make -j4 test ARGS=-V
